<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ì¤„ì„ë§ í…ŒìŠ¤íŠ¸</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    body {
        font-family: 'Segoe UI', Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        background: linear-gradient(135deg, #e0eafc, #cfdef3);
        overscroll-behavior: none;
    }
    .container {
        background-color: #ffffff;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        text-align: center;
        width: 90vw;
        max-width: 400px;
        transition: transform 0.3s ease;
    }
    .container:hover { transform: translateY(-2px); }
    h2, h3 { color: #333; margin-bottom: 12px; font-weight: 600; font-size: 16px; }
    input { margin: 6px; padding: 8px; width: 85%; max-width: 180px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px; transition: border-color 0.3s ease; }
    input:focus { border-color: #4CAF50; outline: none; }
    button {
        padding: 8px 16px;
        background: linear-gradient(45deg, #4CAF50, #66BB6A);
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        margin: 6px;
        font-size: 13px;
        font-weight: 500;
        transition: background 0.3s ease;
        min-width: 90px;
        touch-action: manipulation;
    }
    button:hover { background: linear-gradient(45deg, #45a049, #5cb85c); }
    .radio-group { margin: 12px 0; display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; }
    .radio-group label { font-size: 13px; color: #555; }
    #loginSection, #testSection, #resultSection, #graphSection, #addQuestionSection { display: none; }
    #question { font-size: 14px; color: #333; margin: 12px 0; font-weight: 500; word-break: break-word; overflow-wrap: break-word; }
    canvas { margin-top: 12px; max-width: 100%; border-radius: 6px; background: #fff; padding: 6px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); }
    .no-data { font-size: 14px; color: #555; margin: 12px 0; }
    .table-container { max-width: 100%; overflow-x: auto; margin-top: 12px; }
    table { width: 100%; border-collapse: collapse; font-size: 12px; text-align: center; }
    th, td { border: 1px solid #ddd; padding: 6px; min-width: 60px; }
    th { background-color: #f5f5f5; font-weight: 600; color: #333; }
    td { color: #555; }
    @media (max-width: 400px) {
        h2, h3 { font-size: 14px; }
        input, button { font-size: 12px; padding: 6px 12px; }
        .radio-group label { font-size: 12px; }
        #question { font-size: 13px; }
        .container { padding: 12px; }
        button { min-width: 80px; }
        table { font-size: 11px; }
        th, td { padding: 4px; min-width: 50px; }
    }
    @media (max-width: 320px) {
        input { max-width: 150px; }
        button { min-width: 70px; font-size: 11px; }
        table { font-size: 10px; }
        th, td { min-width: 40px; }
    }
</style>
</head>
<body>
<div class="container">
    <h2>ğŸ¯ ì¤„ì„ë§ í…ŒìŠ¤íŠ¸</h2>

    <div id="loginSection">
        <h3>ğŸ‘¤ ê·œë¯¼ ë¡œê·¸ì¸</h3>
        <div>
            <label for="adminId">ì•„ì´ë””:</label>
            <input type="text" id="adminId" placeholder="ì•„ì´ë”” ì…ë ¥">
        </div>
        <div>
            <label for="adminPassword">ë¹„ë°€ë²ˆí˜¸:</label>
            <input type="password" id="adminPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
        </div>
        <button onclick="adminLogin()">ğŸ”‘ ë¡œê·¸ì¸</button>
    </div>

    <form id="infoForm" onsubmit="startTest(event)">
        <h3>ğŸ“ í•™ìƒ ì •ë³´ ì…ë ¥</h3>
        <div>
            <label for="name">ì´ë¦„:</label>
            <input type="text" id="name" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
        </div>
        <div>
            <button type="submit">â–¶ í…ŒìŠ¤íŠ¸ ì‹œì‘</button>
            <button type="button" onclick="showAdminLogin()">ğŸ‘¤ ê·œë¯¼ ë¡œê·¸ì¸</button>
        </div>
    </form>

    <div id="testSection">
        <h3>ğŸ“š ì¤„ì„ë§ í…ŒìŠ¤íŠ¸</h3>
        <p id="question"></p>
        <div class="radio-group">
            <label>âœ… <input type="radio" name="answer" value="yes"> ì”ë‹ˆë‹¤</label>
            <label>âŒ <input type="radio" name="answer" value="no"> ì•ˆì”ë‹ˆë‹¤</label>
        </div>
        <button onclick="nextQuestion()">â¡ ë‹¤ìŒ</button>
        <button onclick="goBack('testSection')">ğŸ”™ ë’¤ë¡œ ê°€ê¸°</button>
    </div>

    <div id="resultSection">
        <h3>ğŸ† í…ŒìŠ¤íŠ¸ ê²°ê³¼</h3>
        <p id="result"></p>
        <canvas id="personalScoreChart"></canvas>
        <!-- ë‹¤ì‹œ ì‹œì‘ ë²„íŠ¼ ì œê±° -->
        <button onclick="goBack('resultSection')">ğŸ”™ ë’¤ë¡œ ê°€ê¸°</button>
    </div>

    <div id="addQuestionSection">
        <h3>â• ì§ˆë¬¸ ì¶”ê°€</h3>
        <div>
            <label for="newQuestion">ìƒˆ ì¤„ì„ë§:</label>
            <input type="text" id="newQuestion" placeholder="ì¤„ì„ë§ ì…ë ¥">
        </div>
        <button onclick="addQuestion()">âœ… ì§ˆë¬¸ ì¶”ê°€</button>
        <button onclick="showGraph()">ğŸ“Š ê·¸ë˜í”„ ë³´ê¸°</button>
        <button onclick="showTable()">ğŸ—‚ í•™ìƒ ì‘ë‹µ ë³´ê¸°</button>
        <button onclick="resetStudentData()">ğŸ§¹ í•™ìƒ ë°ì´í„° ì´ˆê¸°í™”</button>
        <button onclick="goBack('addQuestionSection')">ğŸ”™ ë’¤ë¡œ ê°€ê¸°</button>
        <div id="responseTable" class="table-container"></div>
    </div>

    <div id="graphSection">
        <h3>ğŸ“ˆ ì „ì²´ í•™ìƒ ì ìˆ˜</h3>
        <div id="noDataMessage" class="no-data" style="display: none;">í•™ìƒ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
        <canvas id="scoreChart" style="display: none;"></canvas>
        <button onclick="restartTest()">ğŸ”„ ë‹¤ì‹œ ì‹œì‘</button>
        <button onclick="goBack('graphSection')">ğŸ”™ ë’¤ë¡œ ê°€ê¸°</button>
    </div>
</div>

<script>
let questions = JSON.parse(localStorage.getItem('questions')) || [
    { text: "ìƒíŒŒ", correct: "no" },
    { text: "ìƒì„ ", correct: "no" },
    { text: "ì˜í†µ", correct: "no" },
    { text: "ì¹´í†¡", correct: "no" },
    { text: "ã…‡ã…‡", correct: "no" },
    { text: "ã…‡ã…ˆ", correct: "no" },
    { text: "ã…‡ã…‹", correct: "no" }
];
let currentQuestion = 0;
let score = 0;
let studentData = JSON.parse(localStorage.getItem('studentData')) || [];
let currentStudent = {};
let currentResponses = [];
let chartInstance = null;
let personalChartInstance = null;

window.onload = () => { document.getElementById('infoForm').style.display = 'block'; };

function showAdminLogin() {
    document.getElementById('infoForm').style.display = 'none';
    document.getElementById('loginSection').style.display = 'block';
}

function adminLogin() {
    const id = document.getElementById('adminId').value;
    const password = document.getElementById('adminPassword').value;
    if (id === "2541" && password === "2541") {
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('addQuestionSection').style.display = 'block';
        showTable();
    } else alert('ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.');
}

function goBack(currentSection) {
    document.getElementById(currentSection).style.display = 'none';
    if (currentSection === 'testSection') {
        document.getElementById('infoForm').style.display = 'block';
        document.getElementById('infoForm').reset();
    } else if (currentSection === 'resultSection') {
        document.getElementById('testSection').style.display = 'block';
        currentQuestion = questions.length - 1;
        loadQuestion();
        if (personalChartInstance) { personalChartInstance.destroy(); personalChartInstance=null; }
    } else if (currentSection === 'addQuestionSection') {
        document.getElementById('loginSection').style.display = 'block';
        document.getElementById('adminId').value = '';
        document.getElementById('adminPassword').value = '';
    } else if (currentSection === 'graphSection') {
        document.getElementById('addQuestionSection').style.display = 'block';
        showTable();
    }
}

function startTest(event) {
    event.preventDefault();
    const nameInput = document.getElementById('name').value.trim();
    if (!nameInput) { alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }
    currentStudent = { name: nameInput };
    currentResponses = [];
    document.getElementById('infoForm').style.display = 'none';
    document.getElementById('testSection').style.display = 'block';
    currentQuestion = 0; score = 0;
    loadQuestion();
}

function loadQuestion() {
    if (currentQuestion < questions.length && questions[currentQuestion]) {
        document.getElementById('question').textContent = `ë¬¸ì œ ${currentQuestion + 1}: "${questions[currentQuestion].text}"ì„(ë¥¼) ì‚¬ìš©í•©ë‹ˆê¹Œ?`;
        document.querySelectorAll('input[name="answer"]').forEach(radio => radio.checked=false);
    } else showResult();
}

function nextQuestion() {
    const selected = document.querySelector('input[name="answer"]:checked');
    if (!selected) { alert('ë‹µì„ ì„ íƒí•´ì£¼ì„¸ìš”!'); return; }
    currentResponses.push(selected.value);
    if (selected.value === questions[currentQuestion].correct) score++;
    currentQuestion++; loadQuestion();
}

function showResult() {
    document.getElementById('testSection').style.display='none';
    document.getElementById('resultSection').style.display='block';

    const percentage = Math.round((score/questions.length)*100);
    document.getElementById('result').textContent = `ğŸ‰ ${currentStudent.name}ë‹˜ì˜ ì ìˆ˜: ${score}/${questions.length} (${percentage}ì )`;

    // í•™ìƒ ë°ì´í„° ì €ì¥
    studentData.push({ label: currentStudent.name, score: percentage, responses: currentResponses });
    localStorage.setItem('studentData', JSON.stringify(studentData));

    // ê°œì¸ ì ìˆ˜ ì°¨íŠ¸
    if(personalChartInstance) personalChartInstance.destroy();
    const ctx = document.getElementById('personalScoreChart').getContext('2d');
    personalChartInstance = new Chart(ctx, {
        type:'bar',
        data:{
            labels:[currentStudent.name],
            datasets:[{
                label:'ë‚´ ì ìˆ˜ (1-100)',
                data:[percentage],
                backgroundColor:'rgba(75,192,192,0.7)',
                borderColor:'rgba(75,192,192,1)',
                borderWidth:2, borderRadius:6
            }]
        },
        options:{ responsive:true, scales:{ y:{ beginAtZero:true, max:100 } } }
    });

    // ë‹¤ì‹œ ì‹œì‘ ë²„íŠ¼ ì œê±°
    const restartBtn = document.querySelector('#resultSection button[onclick="restartTest()"]');
    if (restartBtn) restartBtn.style.display = 'none';
}

function addQuestion() {
    const newQuestionText = document.getElementById('newQuestion').value.trim();
    if (!newQuestionText) { alert('ì¤„ì„ë§ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }
    questions.push({ text:newQuestionText, correct:'no' });
    localStorage.setItem('questions', JSON.stringify(questions));
    document.getElementById('newQuestion').value='';
    alert('âœ… ì§ˆë¬¸ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
}

function resetStudentData() {
    if(!confirm('ëª¨ë“  í•™ìƒ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    studentData=[]; localStorage.removeItem('studentData');
    if(chartInstance){ chartInstance.destroy(); chartInstance=null; }
    document.getElementById('responseTable').innerHTML='';
    alert('ğŸ§¹ í•™ìƒ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
    document.getElementById('addQuestionSection').style.display='block';
    document.getElementById('graphSection').style.display='none';
}

function showTable() {
    const tableContainer = document.getElementById('responseTable');
    if(studentData.length===0){ tableContainer.innerHTML='<p class="no-data">í•™ìƒ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>'; return; }

    let table='<table><thead><tr><th>í•™ìƒ</th>';
    questions.forEach((q,index)=>{ table+=`<th>ë¬¸ì œ ${index+1}</th>`; });
    table+='</tr></thead><tbody>';

    studentData.forEach(student=>{
        table+=`<tr><td>${student.label}</td>`;
        student.responses.forEach(r=>table+=`<td>${r==='yes'?'âœ… ì”ë‹ˆë‹¤':'âŒ ì•ˆì”ë‹ˆë‹¤'}</td>`);
        table+='</tr>';
    });
    table+='</tbody></table>';
    tableContainer.innerHTML=table;
}

function showGraph() {
    document.getElementById('resultSection').style.display='none';
    document.getElementById('infoForm').style.display='none';
    document.getElementById('testSection').style.display='none';
    document.getElementById('addQuestionSection').style.display='none';
    document.getElementById('graphSection').style.display='block';

    const noDataMessage=document.getElementById('noDataMessage');
    const scoreChart=document.getElementById('scoreChart');

    if(studentData.length===0){ noDataMessage.style.display='block'; scoreChart.style.display='none'; return; }
    else{ noDataMessage.style.display='none'; scoreChart.style.display='block'; }

    if(chartInstance){ chartInstance.destroy(); }

    const ctx=scoreChart.getContext('2d');
    chartInstance = new Chart(ctx,{
        type:'bar',
        data:{
            labels: studentData.map(d=>d.label),
            datasets:[{
                label:'ì¤„ì„ë§ ë¹„ì‚¬ìš© ì ìˆ˜ (1-100)',
                data: studentData.map(d=>d.score),
                backgroundColor: [
                    'rgba(75,192,192,0.7)',
                    'rgba(54,162,235,0.7)',
                    'rgba(255,206,86,0.7)',
                    'rgba(255,99,132,0.7)',
                    'rgba(153,102,255,0.7)',
                    'rgba(255,159,64,0.7)',
                    'rgba(199,199,199,0.7)'
                ],
                borderColor:[
                    'rgba(75,192,192,1)',
                    'rgba(54,162,235,1)',
                    'rgba(255,206,86,1)',
                    'rgba(255,99,132,1)',
                    'rgba(153,102,255,1)',
                    'rgba(255,159,64,1)',
                    'rgba(199,199,199,1)'
                ],
                borderWidth:2, borderRadius:6
            }]
        },
        options:{ responsive:true, scales:{ y:{ beginAtZero:true, max:100 } } }
    });
}

function restartTest() {
    currentQuestion=0; score=0; currentStudent={}; currentResponses=[];
    document.getElementById('testSection').style.display='none';
    document.getElementById('resultSection').style.display='none';
    document.getElementById('graphSection').style.display='none';
    document.getElementById('addQuestionSection').style.display='none';
    document.getElementById('infoForm').style.display='block';
    document.getElementById('infoForm').reset();
    if(personalChartInstance){ personalChartInstance.destroy(); personalChartInstance=null; }
}
</script>
</body>
</html>
