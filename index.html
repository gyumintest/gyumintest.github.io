<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì¤„ì„ë§ í…ŒìŠ¤íŠ¸</title>
  <!-- Pretendard (CDN) -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
  <style>
    :root{
      --bg:#e6f2ff;
      --card:#ffffff;
      --accent:#4aa3ff;
      --muted:#6b7b8a;
      --radius:14px;
      --glass: rgba(255,255,255,0.72);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:PretendardVariable, Pretendard, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', 'Helvetica Neue', Arial}
    body{
      background: radial-gradient(1200px 600px at 10% 10%, #dff0ff 0%, transparent 20%),
                  radial-gradient(1000px 500px at 90% 90%, #eef7ff 0%, transparent 18%),
                  var(--bg);
      display:flex;align-items:center;justify-content:center;padding:28px;
      -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
    }
    .wrap{width:100%;max-width:980px}
    .header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    .brand{background:linear-gradient(90deg,var(--accent),#77c6ff);padding:12px 16px;border-radius:12px;color:#fff;font-weight:700;box-shadow:0 6px 18px rgba(74,163,255,0.18)}
    
    /* ì¤‘ì•™ ë ˆì´ì•„ì›ƒ */
    .main-container{max-width:700px;width:100%;display:flex;flex-direction:column;gap:24px}
    .main-card{background:var(--card);border-radius:var(--radius);padding:28px;box-shadow:0 12px 40px rgba(11,41,64,0.12)}
    
    /* ë²„íŠ¼ */
    .btn-row{display:flex;gap:16px}
    .big-btn{flex:1;padding:16px;border-radius:12px;border:none;cursor:pointer;font-weight:700;font-size:16px;box-shadow:0 8px 24px rgba(11,41,64,0.08);transition:transform .2s ease, box-shadow .2s}
    .big-btn:hover{transform:translateY(-2px);box-shadow:0 12px 32px rgba(11,41,64,0.15)}
    .student-btn{background:linear-gradient(180deg,#fff,#f8fcff);border:1px solid rgba(74,163,255,0.2)}
    .admin-btn{background:linear-gradient(90deg,var(--accent),#3aa0ff);color:#fff}

    .form-section{display:none;margin-top:20px;padding:20px;background:linear-gradient(180deg,#fbfdff,#f4fbff);border-radius:14px;border:1px solid #e9f5ff}
    .form-row{display:flex;gap:12px;align-items:end}
    input[type=text], input[type=password]{flex:1;padding:14px;border-radius:12px;border:1px solid #e6eef8;background:#fbfdff;font-size:15px}
    button.primary{background:var(--accent);color:#fff;padding:14px 24px;border-radius:12px;border:none;cursor:pointer;font-weight:600;font-size:15px}
    label{font-size:14px;color:#08344d;font-weight:500;margin-bottom:8px;display:block}

    .question-box{padding:24px;border-radius:14px;background:linear-gradient(180deg,#fbfdff,#f4fbff);border:1px solid #e9f5ff;box-shadow:0 4px 16px rgba(74,163,255,0.08)}
    .question{font-size:20px;color:#08344d;margin:0 0 24px 0;font-weight:600}
    .small{font-size:14px;color:var(--muted)}

    /* ë‹µë³€ ë²„íŠ¼ë“¤ */
    .answer-buttons{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin:24px 0}
    .answer-btn{padding:20px;border-radius:14px;border:none;cursor:pointer;font-size:18px;font-weight:700;transition:all .2s ease;box-shadow:0 6px 20px rgba(11,41,64,0.12)}
    .answer-btn:hover{transform:translateY(-3px);box-shadow:0 12px 30px rgba(11,41,64,0.2)}
    .answer-yes{background:linear-gradient(135deg,#4ade80,#22c55e);color:#fff}
    .answer-no{background:linear-gradient(135deg,#f87171,#ef4444);color:#fff}
    .answer-btn:active{transform:translateY(0)}
    .answer-btn:disabled{opacity:0.6;transform:none;cursor:not-allowed}

    /* admin panel */
    .admin-panel{margin-top:24px;background:var(--card);border-radius:var(--radius);padding:24px;box-shadow:0 12px 40px rgba(11,41,64,0.12);display:none}
    .admin-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}
    .admin-title{font-size:18px;color:#08344d;font-weight:700}
    .admin-actions{display:flex;gap:12px;align-items:center}
    
    .admin-form-row{display:flex;gap:12px;align-items:center;margin-bottom:16px}
    .admin-input{flex:1;padding:12px;border-radius:12px;border:1px solid #e6eef8;background:#fbfdff}
    .admin-select{width:140px;padding:12px;border-radius:12px;border:1px solid #e6eef8;background:#fbfdff}

    .admin-controls{display:flex;gap:12px;margin-bottom:20px}
    .admin-btn{background:var(--accent);color:#fff;padding:12px 20px;border-radius:12px;border:none;cursor:pointer;font-weight:600;flex:1}
    .reset-btn{background:#fff;border:1px solid #ffd6d6;color:#f04;padding:12px 20px;border-radius:12px;cursor:pointer;font-weight:600;flex:1}

    table{width:100%;border-collapse:collapse;margin-top:16px;font-size:14px}
    th,td{padding:12px;border-bottom:1px solid #f0f5fb;vertical-align:top}
    th{background:#fbfdff;color:#08344d;font-weight:600;text-align:left;width:120px}
    td.score{text-align:center;font-weight:600;color:var(--accent);width:80px}
    td.responses{width:auto;line-height:1.6}
    .response-item{display:block;margin:4px 0;padding:6px 12px;background:rgba(74,163,255,0.1);border-radius:8px;font-size:13px;border-left:3px solid var(--accent)}

    .back-btn, .logout-btn{background:transparent;border:1px solid #e6f3ff;padding:10px 16px;border-radius:10px;cursor:pointer;font-size:14px;font-weight:500}
    .logout-btn{border:none;color:var(--muted)}

    /* responsive */
    @media(max-width:768px){
      body{padding:20px}
      .main-card{padding:24px}
      .btn-row{flex-direction:column}
      .big-btn{padding:14px;font-size:15px}
      .form-row{flex-direction:column;align-items:stretch}
      .answer-buttons{grid-template-columns:1fr;gap:12px}
      .admin-panel{padding:20px;margin-top:20px}
      .admin-controls{flex-direction:column}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="main-container">
      <!-- Header -->
      <div class="header">
        <div class="brand">ì¤„ì„ë§ í…ŒìŠ¤íŠ¸</div>
      </div>

      <!-- Main Card -->
      <div class="main-card">
        <div style="text-align:center">
          <h2 style="margin:0 0 12px 0;color:#08344d;font-size:26px;font-weight:700">í•™ìƒ / ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
          <p class="small" style="color:#08344d">í•™ìƒì€ ì´ë¦„ë§Œ ì…ë ¥í•˜ê³  ì‹œì‘í•˜ì„¸ìš”. ê·œë¯¼ì€ ê´€ë¦¬ì ë²„íŠ¼ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì„¸ìš”.</p>
        </div>

        <div class="btn-row">
          <button class="big-btn student-btn" id="studentStartBtn">ğŸ‘¤ í•™ìƒ ë¡œê·¸ì¸</button>
          <button class="big-btn admin-btn" id="adminStartBtn">ğŸ” ê·œë¯¼ ë¡œê·¸ì¸</button>
        </div>

        <!-- í•™ìƒ ë¡œê·¸ì¸ í¼ -->
        <div id="studentForm" class="form-section">
          <label>ì´ë¦„ ì…ë ¥</label>
          <div class="form-row">
            <input type="text" id="studentName" placeholder="ì˜ˆ: í™ê¸¸ë™" maxlength="10">
            <button class="primary" id="startTestBtn">ğŸš€ í…ŒìŠ¤íŠ¸ ì‹œì‘</button>
          </div>
        </div>

        <!-- ê´€ë¦¬ì ë¡œê·¸ì¸ í¼ -->
        <div id="adminForm" class="form-section">
          <label>ê´€ë¦¬ì ë¡œê·¸ì¸</label>
          <div class="form-row">
            <input type="text" id="adminId" placeholder="ì•„ì´ë””">
            <input type="password" id="adminPw" placeholder="ë¹„ë°€ë²ˆí˜¸">
            <button class="primary" id="adminLoginBtn">ë¡œê·¸ì¸</button>
          </div>
        </div>

        <!-- í€´ì¦ˆ ì˜ì—­ -->
        <div id="quizArea" class="question-box" style="display:none">
          <p class="question" id="questionText">ì§ˆë¬¸ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
          
          <div class="answer-buttons">
            <button id="answerYes" class="answer-btn answer-yes">âœ… ì”ë‹ˆë‹¤</button>
            <button id="answerNo" class="answer-btn answer-no">âŒ ì•ˆì”ë‹ˆë‹¤</button>
          </div>
          
          <div id="quizProgress" class="small" style="text-align:right;margin-top:20px"></div>
          
          <div style="margin-top:32px;text-align:center">
            <button id="quitBtn" class="primary" style="padding:14px 32px;font-size:16px">â¹ï¸ í…ŒìŠ¤íŠ¸ ì¤‘ë‹¨</button>
          </div>
        </div>
      </div>

      <!-- Admin Panel -->
      <div class="admin-panel" id="adminPanel">
        <div class="admin-header">
          <div>
            <div class="admin-title">ğŸ‘‘ ê´€ë¦¬ì íŒ¨ë„</div>
            <p class="small muted">ì§ˆë¬¸ ì¶”ê°€ / í•™ìƒ ì‘ë‹µ í™•ì¸ / ì´ˆê¸°í™”</p>
          </div>
          <div class="admin-actions">
            <button id="backToStudent" class="back-btn">â† í•™ìƒí™”ë©´</button>
            <button id="adminLogout" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
          </div>
        </div>

        <div class="admin-form-row">
          <input type="text" id="newQuestionInput" class="admin-input" placeholder="ìƒˆ ì¤„ì„ë§ ì…ë ¥ (ì˜ˆ: ã…‡ã…‡)">
          <select id="defaultAnswer" class="admin-select">
            <option value="no">ì•ˆì”ë‹ˆë‹¤ (ê¸°ë³¸)</option>
            <option value="yes">ì”ë‹ˆë‹¤</option>
          </select>
          <button id="addQuestionBtn" class="admin-btn">â• ì§ˆë¬¸ ì¶”ê°€</button>
        </div>

        <div class="admin-controls">
          <button id="refreshTable" class="admin-btn" style="background:#2b8cff">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
          <button id="resetAll" class="reset-btn">ğŸ—‘ï¸ ëª¨ë“  í•™ìƒ ì´ˆê¸°í™”</button>
        </div>

        <div style="overflow:auto;max-height:400px">
          <table id="studentsTable">
            <thead><tr><th>í•™ìƒ</th><th>ì ìˆ˜</th><th>ì‘ë‹µ ìƒì„¸</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    const LS_KEY = 'sl_test_db_v2';
    let SQL, db, questions = [], studentData = [];

    // ëª¨ë“  í¼ ìˆ¨ê¸°ê¸°
    function hideAllForms() {
      document.getElementById('studentForm').style.display = 'none';
      document.getElementById('adminForm').style.display = 'none';
      document.getElementById('quizArea').style.display = 'none';
      document.getElementById('adminPanel').style.display = 'none';
    }

    // ì´ˆê¸°í™”
    async function initSQL() {
      SQL = await initSqlJs({ locateFile: file => 'https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/' + file });
      
      const saved = localStorage.getItem(LS_KEY);
      if (saved) {
        try {
          const arr = JSON.parse(saved);
          const u8 = new Uint8Array(arr);
          db = new SQL.Database(u8);
        } catch (e) {
          db = new SQL.Database();
        }
      } else {
        db = new SQL.Database();
      }

      db.run(`CREATE TABLE IF NOT EXISTS questions (id INTEGER PRIMARY KEY AUTOINCREMENT, text TEXT NOT NULL, correct TEXT NOT NULL)`);
      db.run(`CREATE TABLE IF NOT EXISTS students (id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, score INTEGER NOT NULL, responses TEXT NOT NULL)`);

      // ê¸°ë³¸ ì§ˆë¬¸ ì¶”ê°€
      const countRes = db.exec("SELECT COUNT(*) FROM questions");
      if (countRes[0]?.values?.[0]?.[0] === 0) {
        const defaults = [
          {t:'ìƒíŒŒ', c:'no'}, {t:'ìƒì„ ', c:'no'}, {t:'ì˜í†µ', c:'no'}, {t:'ì¹´í†¡', c:'no'}, 
          {t:'ã…‡ã…‡', c:'no'}, {t:'ã…‡ã…ˆ', c:'no'}, {t:'ã…‡ã…‹', c:'no'}
        ];
        const stmt = db.prepare("INSERT INTO questions (text, correct) VALUES (?, ?)");
        defaults.forEach(q => stmt.run([q.t, q.c]));
        stmt.free();
        saveDB();
      }

      await loadQuestions();
      await loadStudents();
    }

    function saveDB() {
      const data = db.export();
      localStorage.setItem(LS_KEY, JSON.stringify(Array.from(data)));
    }

    async function loadQuestions() {
      questions = [];
      const r = db.exec('SELECT id, text, correct FROM questions ORDER BY id');
      if (r[0]?.values) {
        r[0].values.forEach(row => questions.push({id:row[0], text:row[1], correct:row[2]}));
      }
    }

    async function loadStudents() {
      studentData = [];
      const r = db.exec('SELECT id, name, score, responses FROM students ORDER BY id DESC');
      if (r[0]?.values) {
        r[0].values.forEach(row => {
          let parsed = [];
          try { parsed = JSON.parse(row[3]); } catch(e) {}
          studentData.push({id:row[0], name:row[1], score:row[2], responses:parsed});
        });
      }
    }

    let current = {name:'', idx:0, score:0, responses:[]};

    // ì´ë²¤íŠ¸ ë°”ì¸ë”©
    document.getElementById('studentStartBtn').onclick = () => {
      hideAllForms();
      document.getElementById('studentForm').style.display = 'block';
    };

    document.getElementById('adminStartBtn').onclick = () => {
      hideAllForms();
      document.getElementById('adminForm').style.display = 'block';
    };

    document.getElementById('startTestBtn').onclick = () => {
      const name = document.getElementById('studentName').value.trim();
      if (!name) return alert('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!');
      startQuizFor(name);
    };

    document.getElementById('adminLoginBtn').onclick = () => {
      const id = document.getElementById('adminId').value.trim();
      const pw = document.getElementById('adminPw').value.trim();
      if ((id === 'ê·œë¯¼' || id === '2541') && pw === '2541') {
        showAdminPanel();
      } else {
        alert('âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨!');
      }
    };

    document.getElementById('answerYes').onclick = () => submitAnswer('yes');
    document.getElementById('answerNo').onclick = () => submitAnswer('no');

    document.getElementById('quitBtn').onclick = () => {
      if (confirm('ì •ë§ ì¤‘ë‹¨í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) location.reload();
    };

    function startQuizFor(name) {
      current = {name, idx:0, score:0, responses:[]};
      hideAllForms();
      document.getElementById('quizArea').style.display = 'block';
      showQuestion();
    }

    function showQuestion() {
      if (current.idx >= questions.length) return finishQuiz();
      
      document.getElementById('questionText').textContent = 
        `ë¬¸ì œ ${current.idx+1}/${questions.length}\n"${questions[current.idx].text}"ì„(ë¥¼) ì‚¬ìš©í•©ë‹ˆê¹Œ?`;
      
      document.getElementById('quizProgress').textContent = 
        `${current.idx+1}/${questions.length}`;
      
      document.getElementById('answerYes').disabled = false;
      document.getElementById('answerNo').disabled = false;
    }

    function submitAnswer(answer) {
      document.getElementById('answerYes').disabled = true;
      document.getElementById('answerNo').disabled = true;
      
      current.responses.push(answer);
      if (answer === questions[current.idx].correct) current.score++;
      current.idx++;
      
      setTimeout(showQuestion, 400);
    }

    function finishQuiz() {
      const pct = Math.round((current.score / questions.length) * 100);
      const stmt = db.prepare('INSERT INTO students (name, score, responses) VALUES (?, ?, ?)');
      stmt.run([current.name, pct, JSON.stringify(current.responses)]);
      stmt.free();
      saveDB();
      alert(`${current.name}ë‹˜ ì™„ë£Œ!\nì ìˆ˜: ${pct}%`);
      location.reload();
    }

    function showAdminPanel() {
      hideAllForms();
      document.getElementById('adminPanel').style.display = 'block';
      loadStudents().then(renderStudentsTable);
    }

    document.getElementById('refreshTable').onclick = async () => {
      await loadStudents();
      renderStudentsTable();
    };

    document.getElementById('addQuestionBtn').onclick = async () => {
      const txt = document.getElementById('newQuestionInput').value.trim();
      if (!txt) return alert('ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”!');
      
      const def = document.getElementById('defaultAnswer').value;
      const stmt = db.prepare('INSERT INTO questions (text, correct) VALUES (?, ?)');
      stmt.run([txt, def]);
      stmt.free();
      saveDB();
      await loadQuestions();
      alert('âœ… ì¶”ê°€ë¨!');
      document.getElementById('newQuestionInput').value = '';
    };

    document.getElementById('resetAll').onclick = async () => {
      if (confirm('ëª¨ë“  í•™ìƒ ë°ì´í„° ì‚­ì œ?')) {
        db.run('DELETE FROM students');
        saveDB();
        await loadStudents();
        renderStudentsTable();
        alert('âœ… ì´ˆê¸°í™” ì™„ë£Œ!');
      }
    };

    document.getElementById('backToStudent').onclick = 
    document.getElementById('adminLogout').onclick = () => {
      hideAllForms();
      document.getElementById('adminForm').style.display = 'block';
    };

    function renderStudentsTable() {
      const tbody = document.querySelector('#studentsTable tbody');
      tbody.innerHTML = '';
      
      if (studentData.length === 0) {
        tbody.innerHTML = '<tr><td colspan="3" style="text-align:center;padding:40px;color:var(--muted)">í•™ìƒ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        return;
      }
      
      studentData.forEach(s => {
        const tr = document.createElement('tr');
        const responses = s.responses.map((r, i) => 
          `<span class="response-item">${i+1}. ${r === 'yes' ? 'âœ… ì”ë‹ˆë‹¤' : 'âŒ ì•ˆì”ë‹ˆë‹¤'}</span>`
        ).join('');
        
        tr.innerHTML = `
          <td style="font-weight:600">${s.name}</td>
          <td class="score">${s.score}%</td>
          <td>${responses || '-'}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // ì‹œì‘!
    initSQL().then(() => console.log('ğŸš€ ì¤€ë¹„ì™„ë£Œ!'));
  </script>
</body>
</html>
